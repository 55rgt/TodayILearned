## 스코프 체인

- 스코프 체인을 이해해야 변수에 대한 인식 메커니즘을 알 수 있고, 현재 사용되는 변수가 어디에서 선언된 변수인지 정확히 알 수 있다.
- 자바스크립트에서는 함수 내의 {, } 블록(즉 for 문, if 문 등)은 유효 범위가 없다.
- 오직 함수만이 유효 범위의 한 단위가 되고, 이 유효 범위를 나타내는 스코프가 [[scope]] 프로퍼티로 각 함수 객체 내에서 연결 리스트 형식으로 관리된다.
  → **스코프 체인**

**각각의 함수는 [[scope]] 프로퍼티로 자신이 생성된 실행 컨텍스트의 스코프 체인을 참조한다.**

→ 함수가 실행되는 순간 실행 컨텍스트가 만들어지고, **이 실행 컨텍스트는 실행된 함수의 [[scope]] 프로퍼티를 기반으로 새로운 스코프 체인을 만든다.**

### 1. 전역 실행 컨텍스트의 스코프 체인

```javascript 1.8
/** 전역 코드 */
var var1 = 1;
var var2 = 2;
    
console.log(var1);  // 1
console.log(var2);  // 2
```

- 먼저 전역 실행 컨텍스트가 생성되고, 변수 객체가 만들어진다.
- 이 변수 객체의 스코프 체인은 자기 자신만을 가진다.
- → 변수 객체의 [[scope]]는 변수 객체 자신을 가리킨다.
- 변수 객체가 곧 전역 객체가 된다.


        ______전역 실행 컨텍스트________   
        |                         |
        |        [변수 객체]        |  
        |     ______________      |
        |    |              |     |
        |    |   [[scope]]  :-----------> 스코프 체인
        |    |     var1     |     |       0: 전역 객체
        |    |     var2     |     |
        |    |     this     |     |
        |    |______________|     |
        |_________________________| 

### 2. 함수를 호출한 경우 생성되는 실행 컨텍스트의 스코프 체인

```javascript 1.8
    var var1 = 1;
    var var2 = 2;
    function func(){
        var var1 = 10;
        var var2 = 20;
        console.log(var1);  // 10
        console.log(var2);  // 20
    }
    func();
    console.log(var1);      // 1
    console.log(var2);      // 2
```
- 위 예제를 실행하면 전역 실행 컨텍스트가 생성되고, func() 함수 객체가 만들어진다.
- func 함수 객체의 [[scope]]는 전역 변수 객체가 된다.
- func() 함수를 실행하여 새로운 컨텍스트가 만들어진다.
- func 컨텍스트의 스코프 체인은 실행한 함수의 [[scope]] 프로퍼티를 그대로 복사한 후, 현재 생성된 변수 객체를 복사한 스코프 체인의 맨 앞에 추가한다.


        ______전역 실행 컨텍스트________        ______func 실행 컨텍스트______
        |                         |        |                         |
        |        [변수 객체]        |        |        [변수 객체]         |
        |     ______________      |        |     ______________      |
        |    |              |     |        |    |              |     |
        |    |   [[scope]]  |     |        |    |  [[scope]]   :------------>   <스코프 체인>
        |    |     var1     |     |        |    |     var1     |     |        1. func 변수 객체
        |    |     var2     |     |        |    |     var2     |     |        0. 전역 객체
        |    |     func     :------------->|    |     this     |     |   
        |    |     this     |     |        |    |______________|     |
        |    |______________|     |        |_________________________|
        |_________________________|        

- **각 함수 객체는 [[scope]] 프로퍼티로 현재 컨텍스트의 스코프 체인을 참조한다.**
- 한 함수가 실행될 때 만들어지는 새로운 실행 컨텍스트는 자신이 사용할 스코프 체인을 아래와 같은 방법으로 만든다.
- → **현재 실행되는 함수 객체의 [[scope]] 프로퍼티를 복사하고, 새롭게 생성된 변수 객체를 해당 체인의 제일 앞에 추가한다.**
- 즉, **스코프 체인 = 현재 실행 컨텍스트의 변수 객체 + 상위 컨텍스트의 스코프 체인**


- 식별자 인식은 스코프 체인의 첫번째 변수 객체부터 시작한다.
- 식별자와 대응되는 이름을 가진 프로퍼티가 있는지를 확인한다.
- 이런 식으로 대응되는 이름의 프로퍼티를 찾을 떄까지 계속 반복한다.

#####호이스팅

```javascript 1.8
foo();
bar();
    
var foo = function(){
    console.log('foo and x = ' + x);
};
    
function bar(){
    console.log("bar and x = " + x);
}
    
var x = 1;
    
/* 위 예제는 아래와 같다. */
    
var foo;
    
function bar(){
    console.log("bar and x = " + x);
}
    
var x;
    
foo();  // TypeError
bar();
    
foo = function() {
    console.log('foo and x = ' + x);
};
    
x = 1;
```